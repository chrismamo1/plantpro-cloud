before_script:
 - echo '@edge http://dl-4.alpinelinux.org/alpine/edge/main/' >> /etc/apk/repositories
 - apk update
 - apk add make m4 ocaml perl build-base gcc zlib-dev opam patch sqlite-dev glib-dev pkgconfig gmp-dev ncurses-dev camlp4 git bash nodejs-npm@edge
 - npm install --save -g nightmare
 - npm install --save -g mocha
 - export OPAMYES=true
 - comp=${1:-system}
 - opam init --comp="${comp}"
 - opam switch 4.03.0
 - eval `opam config env`
 - opam update
 - opam install camlp4
 - opam pin add opium https://github.com/chrismamo1/opium.git
 - eval `opam config env`
 - ocaml -version
 - opam --version
 - camlp4 -version

build:
  script: "cd server && opam pin add plantpi . && make check"
