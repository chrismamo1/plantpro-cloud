<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <title>PlantPi: Dashboard</title>
        <!--Shortcut icon-->
        <link rel="shortcut icon" href="https://d30y9cdsu7xlg0.cloudfront.net/png/3973-200.png" />
        <script>
var username = hex2a(getCookie("username"));

function getCookie(name) {
    var value = "; " + document.cookie;
    var parts = value.split("; " + name + "=");
    if (parts.length == 2)
        return parts.pop().split(";").shift();
}

function hex2a(hexx) {
    var hex = hexx.toString();
    var str = '';
    for (var i = 0; i < hex.length; i += 2)
        str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
    return str;
}

function doWork() {
    var EasterEgg = document.getElementById("Easter");
    var Leaf = document.getElementById("Leaf");
    var xicon = document.getElementsByClassName("close")[0];

    Leaf.onclick = function(){ //When leaf is clicked on
        EasterEgg.style.display="block";
    };
    xicon.onclick = function() { //when "X" icon is clicked on
        EasterEgg.style.display = "none";
    };
    window.onclick = function(event) { //Close window if user clicks outside the box
        if (event.target == EasterEgg) {
            EasterEgg.style.display = "none";
        }
    };

    var xhr = new XMLHttpRequest();
    console.log(hex2a(getCookie("username")));
    xhr.open("get", "/get-devices/" + username + "/all");
    xhr.addEventListener("load", function() {
        var plantname = JSON.parse(this.response)[0].name;
        //This is just to give the site some more personality
        pname.innerHTML += plantname;
    });
    xhr.send();

}
        </script>

    </head>
    <body onload="doWork();">
        <!--.....................................................................................................Begin NavBar............................................................................-->
        <nav class="navbar navbar-inverse bg-inverse navbar-fixed-top">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#TheNavBar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="dashboard.html">PlantPi</a>
                </div>
                <!--Allow for better compatability when resizing-->
                <div class="collapse navbar-collapse" id="TheNavBar">
                    <ul class="nav navbar-nav navbar-right">
                <script>
document.write("<li><a><span class=\"glyphicon glyphicon-user\"></span> " + username + "</a></li>");
                </script>
                        <!--<li><a><span class="glyphicon glyphicon-user"></span> TheLegend27</a></li>-->
                        <li> <a href="settings.html"><span class="glyphicon glyphicon-cog"></span> Settings</a></li>
                        <li><a href="index.html"><span class="glyphicon glyphicon-log-out"></span> Signout</a></li>
                        <li><a id="Leaf"><span class="glyphicon glyphicon-leaf"></span></a></li>
                        <div id="Easter" class="EasterEgg">
                            <div class="EasterEgg-content">
                                <span class="close">&times;</span>
                                <img src="https://www.askideas.com/media/39/Yes-Human-Plant-For-Your-Rabbit-Overlords-Funny-Rabbit-Meme-Image.jpg" width="80%" height="80%">
                                <p style="color:white" >It's a feature :)</p>
                            </div>
                        </div>
                    </ul>
                </div>
            </div>
        </nav>
        <!--..................................................................................................End NavBar...................................................................................-->
        <br /><br />
        <!--........................................................................................Begin sidebar and stage.....................................................................-->
        <div class="row-offcanvas row-offcanvas-left">
            <div id="sidebar" class="sidebar-offcanvas">
                <br /> <br />
                <div class="col-xs-12">
                    <h3 style="color:#bcbcbc; text-align: center;" >Your Plants <a id="Leaf"><span class="glyphicon glyphicon-tree-conifer" style="color: #007a2a !important;"></span></a></h3><br/>
                    <ul class="nav nav-pills nav-stacked">
                        <h4>Groups:</h4>
                        <ul class="nav" id="groupsList"><!--Intial start of accordian-->

                        <!--This entire thing is just for the indoors dropdown-->
                            <li class="dropdown keep-open" id="menuElement">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Indoors<span class="caret" id="menu-caret"></span></a>
                                    <ul id="menuDrop" class="dropdown-menu keep-open" role="menu">

                                        <!--Dank Weed-->
                                        <ul class="nav innerMenu"><li><button id="setting_cog" class="glyphicon glyphicon-cog pull-right" style="border:none;background-color:transparent;padding-top:13px;"></button><a href="#"> Dank Weed, 90%THC, strong stuff </a></li></ul>

                                        <!--Mystery Plant-->
                                        <ul class="nav innerMenu"><li>
                                            <button data-toggle="collapse" class="glyphicon glyphicon-cog pull-right" style="border:none;background-color:transparent;padding-top:13px;"></button><a href="#">Mystery Plant</a></li>
                                        </ul>
                                    </ul>
                            </li>
                        <!--End indoors dropdown-->
                        </ul>
                        <ul class="nav" id="groupsList"><!--Intial start of accordian-->

                        <!--This entire thing is just for the indoors dropdown-->
                            <li class="dropdown keep-open" id="menuElement">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Scary Basement<span class="caret" id="menu-caret"></span></a>

                                    <ul id="menuDrop" class="dropdown-menu keep-open" role="menu">

                                        <ul class="nav innerMenu"><li><button id="setting_cog" class="glyphicon glyphicon-cog pull-right" style="border:none;background-color:transparent;padding-top:13px;"></button><a href="#"> Dead Twig</a></li>
                                        </ul>


                                        <ul class="nav innerMenu"><li><button onclick="" class="glyphicon glyphicon-cog pull-right" style="border:none;background-color:transparent;padding-top:13px;"></button><a href="#">Venus Flytrap</a></li>
                                        </ul>
                                    </ul>
                            </li>
                            <li class="dropdown keep-open" id="menuElement">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Watered Sidewalks<span class="caret" id="menu-caret"></span></a>
                                    <ul id="menuDrop" class="dropdown-menu keep-open" role="menu">

                                        <!--Dank Weed-->
                                        <div class="innerguts">
                                        <ul class="nav innerMenu"><li><button class="sets glyphicon glyphicon-cog pull-right settings_cog" style="border:none;background-color:transparent;padding-top:13px;"></button><a href="#"> In front of cramer </a></li>

                                                <div class="content" style="display: none">
                                                    <ul class="group-list">
                                                        <p>Settings</p>
                                                        <li><a>Rename</a></li>
                                                        <li>Change Group</li>
                                                        <li>Delete Plant</li>
                                                    </ul>
                                                </div>
                                        </ul>

                                        <!--Mystery Plant-->
                                        <ul class="nav innerMenu"><li><button id="cog1" type="button" class="sets glyphicon glyphicon-cog pull-right" style="border:none;background-color:transparent;padding-top:13px;"></button><a href="#">Library sidewalk</a></li>

                                            <div class="content" id="settingContents" style="display: none">
                                                    <ul class="group-list">
                                                        <p>Settings</p>
                                                        <li><a>Rename</a></li>
                                                        <li>Change Group</li>
                                                        <li>Delete Plant</li>
                                                    </ul>
                                                </div>

                                        </ul>
                                    </ul>
                            </li>
                        <!--End indoors dropdown-->
                        </ul>

                            <div id="groupsListContainer"></div>
                            <br/>
                            <li style="font-size: 12px; float: right;"><a href="settings.html">Manage Groups</a></li>
                            <li class="plus" style="font-size: 13px; float: left;"><a onclick="showCreateGroup()"><span class="btn glyphicon glyphicon-plus"></span></a></li>

                            <br/><br/>

                            <div id="show_create_group" style="display: none;">
                                <form action="/create-group" method="post">
                                    <input type="hidden" value=username name="user" id="uname" />
                                    <input type="text" class="form-control" id="PlantName" name="groupName" placeholder="new group name" />
                                    <button id="savebutton" type="submit" class="btn btn-primary" onclick="addGroup()">Create Group</button>
                                </form>
                            </div>
                            <script>

$(document).ready(function() {
    $("#cog1").click(function () {
        $("#settingContents").slideToggle();
    });
});

function showCreateGroup() {
    var hidden = document.getElementById('show_create_group');
    if (hidden.style.display === 'block') {
        hidden.style.display = 'none';
    } else {
        hidden.style.display = 'block';
    }
};

//Experimental Function to display cog accordinan settings
function displaySettings(){
    //alert("This shit is broken");
    var sets = document.getElementById("dropSettings");
    if(sets.style.display === 'block'){
        sets.style.display = 'none';
    } else {
        sets.style.display = 'block';
    }
};

//These functions keep the dropdown menus open until clicked on again
$('.dropdown.keep-open').on({
    "shown.bs.dropdown": function() { this.closable = false; },
    "click":             function() { this.closable = true; },
    "hide.bs.dropdown":  function() { return this.closable; }
});
$('#menuElement .dropdown-menu').on({
    "click":function(e){
      e.stopPropagation();
    }
});

//This function will only allow one dropdown open at a time



//Toggle sidebar on button press
$(document).ready(function() {
    $('[data-toggle=offcanvas]').click(function() {
        $('.row-offcanvas').toggleClass('active');
    });
});
                            </script>

                    </ul>
                        <hr/>
                        <h4 style="color: #009b09;">All:</h4>
                        <ul class="nav" style="font-size: 15px;">
                            <div id="plantListContainer"></div>
                            <ul class="nav"><li><button onclick="location.href='http:/google.com/'" class="glyphicon glyphicon-cog pull-right" style="border:none;background-color:transparent;padding-top:13px;"></button><a href="broken.html"> Dank Weed, 90%THC, strong stuff </a></li></ul>
                            <br />
                            <br />
                        </ul>
                </div>
            </div>
            <!--...........................................................................Side bar ends here..........................................................................-->
            <!--Begin Stage, To play friendly with the side bar, the "stage" must be within the same div-->
            <div id="stage">
                <div class="col-md-12">
                    <br/>
                    <!--Spawn button for sidebar collapse for better resizing compatability-->
                    <p class="visible-xs"> <button type="button" class="btn btn-primary btn-xs" data-toggle="offcanvas"><i class="glyphicon glyphicon-chevron-left"></i></button> </p>
                    <!--HEADER PLANT NAME, controled by js script dowork()-->
                    <h1> Let's see how <strong id = "pname"></strong> is doing:</h1> <br/>

                    <div id="panel" style="border-style: double; border-width: 2px; border-color: #ccc">
                        <div class="inner_panel">
                            <h2>Statistics</h2>
                            <div class="panel_status">
                                <script> //Status snippet
var txt;
var stat = "Status: ";
var lvl1att = 0, lvl2att = 0, lvl3att = 0;  //These are the flags
var code = 0; //by default
var celcius = 30;
var moisture = false;
//Temp = Celcius, Moisture=T or F, uhh what was light?
//Check for Temperature

//we just need to have a way to figure out what will trigger lvl attention to 1
//Like the temperature is too high, set off the flag, the moisture is too low,
//set off the flag, light levels are low (for a duration), set off the flag.
//This is highly dependant on what type of units we are gonna use though.

//-------------------Determination of attention will go here------------------
//Temp check
var faren = (celcius * (9/5) + 32);
if(faren > 110 || faren < 32){
    lvl1att = 1;
}
//Moisture check
if(!moisture){
    lvl2att = 1;
}
//if 0, no attention needed, if 1, attention is needed
//lvl1 is temperature, lvl2 is moisture, and lvl3 is light level

//what determines the status display is the sum of all level attention
var code = lvl1att + lvl2att + lvl3att;
document.write("<p><strong>" + stat.fontsize(5)  + "</strong> ");
if(code == 0){
    txt  = "It's All Good :)";
    document.write(txt.fontcolor("#009b09").fontsize(4));
}
else if (code == 1 || code == 2){
    txt = "Needs Some Attention!";
    document.write(txt.fontcolor("#b8bf00").fontsize(4));
}
else if (code == 3){
    txt = "DANGER!";
    document.write(txt.fontcolor("#cc0000").fontsize(4));
}
                                </script>
                                <br/>
                                <div class="attention">
                                    <script> //Attention needed snippet
var lvl1 = "Temperature", lvl2 = "Moisture", lvl3 = "Light";
if(code > 0){
    document.write("<p>Attention needed at: ");
    if(lvl1att){
        document.write(lvl1 + ", ");
    }
    if (lvl2att) {
        document.write(lvl2 + ", ");
    }
    if(lvl3att){
        document.write(lvl3 + " ");
    }
    if(code == 3){
        document.write(" <br/>Take some time to save a life.");
    }
    document.write("</p>");
}
else{ //if nothing needs attention, then is "all good" :)
    document.write("<p>Your plant is doing well :)</p>");
}
                                    </script>
                                </div>
                                <br/>
                            </div>

                            <ul>
                                <div id="Level">
                                    <li>Temperature Level</li>
                                </div>
                                <br/>
                                <script>
document.write("<p>Current: " + celcius + "&#8451, " + faren + "&#8457 </p>");
if(faren > 119){
    document.write("<br/><p>Your plant is not far from spontaneously combusting! <span class=\"glyphicon glyphicon-fire\"></span> throw some ice on it or something! <span class=\"glyphicon glyphicon-ice-lolly\"></span> </p>");
}
                                </script>

                                <br/>
                                <div id="Level">
                                    <li>Mositure Level</li>
                                </div>
                                <br/>
                                <script>
if(moisture){
    document.write("<p> There seems to be mositure present :) </p>");
}
else{
    document.write("<p>Needs some moisture!</p>");
}
                                </script>
                                <br/>
                                <div id="Level">
                                    <li>Light Level</li>
                                </div>
                                <br/>
                                <p>Bright as this plants future. </p>
                                <br/>
                            </ul>
                        </div>
                    </div>
                </div>

            </div><!-- End stage and sidebar-->
        </div>
        <script src="dist/bundle.js"></script>
    </body>
</html>
